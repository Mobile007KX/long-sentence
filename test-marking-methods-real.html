<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Qwenæ ‡è®°æ–¹æ¡ˆæµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f7;
        }
        .test-container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h2 {
            color: #1d1d1f;
            border-bottom: 2px solid #007aff;
            padding-bottom: 10px;
        }
        .prompt-box {
            background: #f9fafb;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 14px;
            border: 1px solid #e5e7eb;
        }
        .result-box {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-size: 18px;
            line-height: 1.6;
        }
        .error-box {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        button {
            background: #007aff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            background: #0055d4;
        }
        .loading {
            color: #666;
            font-style: italic;
        }
        .score {
            float: right;
            font-weight: bold;
            color: #007aff;
        }
        /* æ ‡è®°é¢„è§ˆæ ·å¼ */
        .marked-preview {
            font-size: 20px;
            line-height: 1.8;
            padding: 20px;
            background: #fafafa;
            border-radius: 8px;
            margin: 10px 0;
        }
        .subject-mark { color: #d32f2f; font-weight: bold; }
        .verb-mark { color: #1976d2; text-decoration: underline; }
        .object-mark { color: #388e3c; font-style: italic; }
        .clause-mark { border-bottom: 2px dashed #f57c00; }
        .modifier-mark { color: #7b1fa2; background: #f3e5f5; padding: 2px 4px; }
    </style>
</head>
<body>
    <h1>ğŸ§ª Qwenæ ‡è®°æ–¹æ¡ˆå®æµ‹</h1>
    
    <div class="test-container">
        <h2>æµ‹è¯•å¥å­</h2>
        <div class="prompt-box">
The researchers who had been studying climate change patterns for decades finally published their groundbreaking findings which challenged conventional theories yesterday.
        </div>
    </div>

    <button onclick="testAllMethods()">æµ‹è¯•æ‰€æœ‰æ–¹æ¡ˆ</button>
    <button onclick="clearResults()">æ¸…é™¤ç»“æœ</button>

    <div id="testResults"></div>

    <script>
        const API_KEY = 'sk-8a9d17f2199449ca87988c5d82ae30be';
        const API_URL = 'https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions';
        
        const testSentence = "The researchers who had been studying climate change patterns for decades finally published their groundbreaking findings which challenged conventional theories yesterday.";
        
        const prompts = {
            direct: `ç”¨ç‰¹æ®Šç¬¦å·æ ‡è®°å¥å­æˆåˆ†ã€‚

ç¤ºä¾‹ï¼š
è¾“å…¥ï¼šThe boy ate an apple.
è¾“å‡ºï¼š[[The boy]] {{ate}} ((an apple)).

è¾“å…¥ï¼šThe students who work hard succeed.
è¾“å‡ºï¼š[[The students <<who work hard>>]] {{succeed}}.

è§„åˆ™ï¼š
[[ä¸»è¯­]] {{è°“è¯­}} ((å®¾è¯­)) <<å®šè¯­ä»å¥>> **çŠ¶è¯­**

ç°åœ¨æ ‡è®°ï¼š
"${testSentence}"`,

            stepByStep: `æ ‡è®°ä¸‹é¢å¥å­çš„æˆåˆ†ï¼š
"${testSentence}"

æ­¥éª¤ï¼š
1. æ‰¾åˆ°ä¸»å¥è°“è¯­åŠ¨è¯ â†’ published
2. ä¸»è¯­æ˜¯è°“è¯­å‰çš„æ‰€æœ‰å†…å®¹ï¼ˆé™¤ç‹¬ç«‹çŠ¶è¯­ï¼‰ â†’ The researchers who...decades
3. ç”¨[[]]åŒ…è£¹ä¸»è¯­ï¼Œå®šè¯­ä»å¥ç”¨<<>>åµŒå¥—åœ¨å†…
4. ç”¨{{}}åŒ…è£¹è°“è¯­
5. ç”¨(())åŒ…è£¹å®¾è¯­
6. ç”¨**åŒ…è£¹çŠ¶è¯­

è¾“å‡ºæ ¼å¼ï¼šä¸€è¡Œæ ‡è®°å¥½çš„å¥å­`,

            imitation: `å­¦ä¹ æ ‡è®°å¥å­æˆåˆ†ï¼š

å¥å­1ï¼šBirds fly.
æ ‡è®°ï¼š[[Birds]] {{fly}}.

å¥å­2ï¼šThe cat caught a mouse quickly.
æ ‡è®°ï¼š[[The cat]] {{caught}} ((a mouse)) **quickly**.

å¥å­3ï¼šStudents who study hard pass exams.
æ ‡è®°ï¼š[[Students <<who study hard>>]] {{pass}} ((exams)).

æ³¨æ„ï¼šå®šè¯­ä»å¥<<>>è¦åµŒå¥—åœ¨å®ƒä¿®é¥°çš„åè¯æ‰€åœ¨çš„æ‹¬å·å†…ã€‚

ç°åœ¨ç”¨åŒæ ·æ–¹å¼æ ‡è®°ï¼š
"${testSentence}"`,

            minimal: `ç”¨[[ä¸»è¯­]]ã€{{è°“è¯­}}ã€((å®¾è¯­))ã€<<å®šè¯­ä»å¥>>ã€**çŠ¶è¯­**æ ‡è®°ä¸‹é¢çš„å¥å­ã€‚å®šè¯­ä»å¥åµŒå¥—åœ¨è¢«ä¿®é¥°è¯å†…ã€‚

å¥å­ï¼š${testSentence}`
        };
        
        async function testMethod(methodName, prompt) {
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${API_KEY}`
                    },
                    body: JSON.stringify({
                        model: 'qwen-turbo-latest',
                        messages: [
                            { role: "user", content: prompt }
                        ],
                        temperature: 0.3,
                        max_tokens: 500
                    })
                });
                
                const data = await response.json();
                if (data.choices?.[0]?.message?.content) {
                    return data.choices[0].message.content;
                }
                throw new Error('æ— å“åº”');
            } catch (error) {
                return `é”™è¯¯: ${error.message}`;
            }
        }
        
        function evaluateResult(result) {
            // æ£€æŸ¥å…³é”®æ ‡è®°
            const checks = {
                hasSubject: result.includes('[[') && result.includes(']]'),
                hasVerb: result.includes('{{') && result.includes('}}'),
                hasObject: result.includes('((') && result.includes('))'),
                hasClause: result.includes('<<') && result.includes('>>'),
                hasModifier: result.includes('**'),
                hasNesting: result.includes(']] **') || result.includes('>>]]'), // æ£€æŸ¥åµŒå¥—
            };
            
            const score = Object.values(checks).filter(v => v).length / Object.keys(checks).length * 100;
            
            return {
                score: Math.round(score),
                checks: checks
            };
        }
        
        function visualizeMarkedSentence(marked) {
            // è½¬æ¢ä¸ºå¯è§†åŒ–HTML
            let html = marked
                .replace(/\[\[(.+?)\]\]/g, '<span class="subject-mark">$1</span>')
                .replace(/\{\{(.+?)\}\}/g, '<span class="verb-mark">$1</span>')
                .replace(/\(\((.+?)\)\)/g, '<span class="object-mark">$1</span>')
                .replace(/<<(.+?)>>/g, '<span class="clause-mark">$1</span>')
                .replace(/\*\*(.+?)\*\*/g, '<span class="modifier-mark">$1</span>');
            
            return html;
        }
        
        async function testAllMethods() {
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = '<div class="loading">æµ‹è¯•ä¸­...</div>';
            
            let html = '';
            const scores = {};
            
            for (const [methodName, prompt] of Object.entries(prompts)) {
                html += `<div class="test-container">`;
                html += `<h2>æ–¹æ¡ˆï¼š${methodName}</h2>`;
                html += `<div class="prompt-box">${prompt.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</div>`;
                
                const result = await testMethod(methodName, prompt);
                const evaluation = evaluateResult(result);
                scores[methodName] = evaluation.score;
                
                html += `<div class="result-box">`;
                html += `<div class="score">å¾—åˆ†ï¼š${evaluation.score}%</div>`;
                html += `<strong>åŸå§‹è¾“å‡ºï¼š</strong><br>${result.replace(/</g, '&lt;').replace(/>/g, '&gt;')}`;
                html += `</div>`;
                
                if (evaluation.score > 50) {
                    html += `<div class="marked-preview">`;
                    html += `<strong>å¯è§†åŒ–é¢„è§ˆï¼š</strong><br>`;
                    html += visualizeMarkedSentence(result);
                    html += `</div>`;
                }
                
                html += `</div>`;
                
                // å»¶è¿Ÿé¿å…é¢‘ç‡é™åˆ¶
                await new Promise(resolve => setTimeout(resolve, 1000));
            }
            
            // æ‰¾å‡ºæœ€ä½³æ–¹æ¡ˆ
            const bestMethod = Object.entries(scores).reduce((a, b) => a[1] > b[1] ? a : b);
            html = `<div class="test-container" style="background: #e8f5e9;">
                <h2>ğŸ† æœ€ä½³æ–¹æ¡ˆï¼š${bestMethod[0]} (${bestMethod[1]}%)</h2>
            </div>` + html;
            
            resultsDiv.innerHTML = html;
        }
        
        function clearResults() {
            document.getElementById('testResults').innerHTML = '';
        }
    </script>
</body>
</html>