<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Qwenæ ‡è®°æµ‹è¯•å·¥å…· - å¢å¼ºç‰ˆ</title>
    <style>
        body {
            font-family: -apple-system, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f7;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        h1 {
            color: #1d1d1f;
            text-align: center;
        }
        .input-section {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        textarea {
            width: 100%;
            min-height: 120px;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            resize: vertical;
            box-sizing: border-box;
        }
        .preset-sentences {
            margin: 20px 0;
        }
        .sentence-option {
            padding: 10px;
            margin: 5px 0;
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .sentence-option:hover {
            background: #e8f5e9;
            border-color: #4caf50;
        }
        .prompt-templates {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .prompt-card {
            padding: 15px;
            background: #f3f4f6;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
        }
        .prompt-card.active {
            background: #e0f2fe;
            border-color: #0284c7;
        }
        .prompt-card h3 {
            margin: 0 0 10px 0;
            color: #374151;
        }
        button {
            background: #007aff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0055d4;
        }
        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        .result-section {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin: 20px 0;
        }
        .marked-result {
            font-size: 20px;
            line-height: 1.8;
            padding: 20px;
            background: #fafafa;
            border-radius: 8px;
            margin: 15px 0;
            word-wrap: break-word;
        }
        /* æ ‡è®°æ ·å¼ */
        .subject { background: #ffe0e0; color: #d32f2f; padding: 2px 4px; border-radius: 3px; }
        .verb { background: #e3f2fd; color: #1976d2; padding: 2px 4px; border-radius: 3px; text-decoration: underline; }
        .object { background: #e8f5e9; color: #388e3c; padding: 2px 4px; border-radius: 3px; }
        .clause { border-bottom: 2px dashed #f57c00; background: #fff3e0; }
        .modifier { background: #f3e5f5; color: #7b1fa2; padding: 2px 4px; border-radius: 3px; }
        
        .raw-result {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 14px;
            white-space: pre-wrap;
            overflow-x: auto;
        }
        .loading {
            text-align: center;
            color: #666;
            padding: 20px;
        }
        .error {
            color: #dc2626;
            background: #fee;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        label {
            font-weight: bold;
            color: #374151;
            margin-right: 5px;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            padding: 15px;
            background: #f9fafb;
            border-radius: 8px;
            text-align: center;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #007aff;
        }
        .stat-label {
            color: #6b7280;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª Qwenå¥å­æ ‡è®°æµ‹è¯•å·¥å…·</h1>
        
        <div class="input-section">
            <h2>1. é€‰æ‹©æˆ–è¾“å…¥å¥å­</h2>
            
            <div class="preset-sentences">
                <label>é¢„è®¾å¥å­ï¼ˆç‚¹å‡»é€‰æ‹©ï¼‰ï¼š</label>
                <div id="presetList"></div>
            </div>
            
            <label>æˆ–æ‰‹åŠ¨è¾“å…¥å¥å­ï¼š</label>
            <textarea id="sentenceInput" placeholder="è¾“å…¥è¦æµ‹è¯•çš„è‹±è¯­å¥å­..."></textarea>
        </div>
        
        <div class="input-section">
            <h2>2. é€‰æ‹©æˆ–è‡ªå®šä¹‰æç¤ºè¯</h2>
            
            <div class="prompt-templates" id="promptTemplates">
                <!-- æç¤ºè¯æ¨¡æ¿å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
            </div>
            
            <label>æˆ–è‡ªå®šä¹‰æç¤ºè¯ï¼š</label>
            <textarea id="promptInput" placeholder="è¾“å…¥è‡ªå®šä¹‰æç¤ºè¯..."></textarea>
        </div>
        
        <div class="input-section">
            <h2>3. æµ‹è¯•é€‰é¡¹</h2>
            <div class="controls">
                <button onclick="testSingle()">æµ‹è¯•å½“å‰å¥å­</button>
                <button onclick="testAll()">æµ‹è¯•æ‰€æœ‰é¢„è®¾å¥å­</button>
                <button onclick="batchTest()">æ‰¹é‡æµ‹è¯•ï¼ˆå¤šæç¤ºè¯Ã—å¤šå¥å­ï¼‰</button>
                <button onclick="clearResults()">æ¸…é™¤ç»“æœ</button>
            </div>
        </div>
        
        <div id="results"></div>
    </div>

    <script>
        const API_KEY = 'sk-8a9d17f2199449ca87988c5d82ae30be';
        const API_URL = 'https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions';
        
        // é¢„è®¾å¥å­
        const presetSentences = [
            // ç®€å•å¥å­ï¼ˆç”¨äºæµ‹è¯•åŸºç¡€åŠŸèƒ½ï¼‰
            {
                id: 1,
                text: "The students who studied hard finally passed the exam.",
                difficulty: 3,
                category: "basic"
            },
            {
                id: 2,
                text: "The book which I bought yesterday is interesting.",
                difficulty: 2,
                category: "basic"
            },
            // é«˜éš¾åº¦é•¿éš¾å¥
            {
                id: 3,
                text: "Although several Nobel-prize-winning economistsâ€”still lauded for their accurate predictions during the 2008 crisisâ€”cautioned that unchecked algorithmic trading could trigger abrupt flash crashes across global exchanges, the finance minister, emboldened by an unprecedented surge in short-term tax revenues, confidently announced that further regulation would \"stifle innovation\" and must therefore be postponed until an independent impact study was completed.",
                difficulty: 5,
                category: "complex"
            },
            {
                id: 4,
                text: "While the conservation consortium, pressed by dwindling donations and an increasingly hostile political climate, hailed the reintroduction of apex predators as a triumph of evidence-based policy, local ranchers, furious about escalating livestock losses, filed a class-action lawsuit alleging that the agency's environmental-impact statementâ€”rushed through under public pressureâ€”had systematically ignored peer-reviewed data on predation spill-over into adjacent farmlands.",
                difficulty: 5,
                category: "complex"
            },
            {
                id: 5,
                text: "Even after the multinational biotechnology firmâ€”whose synthetic enzymes once revolutionized green manufacturingâ€”had secured emergency approval for a novel mRNA pesticide, regulators in two trade blocs, alarmed by activist reports of unforeseen gene-drift scenarios, demanded real-world ecosystem trials spanning three growth cycles before allowing commercial deployment, thereby delaying projected market entry by at least twenty-seven months.",
                difficulty: 5,
                category: "complex"
            },
            {
                id: 6,
                text: "Although her campaign staff, convinced by a last-minute focus-group report indicating a sharp rise in youth engagement, urged an aggressive social-media rollout, the incumbent senator, wary of exacerbating donor fatigue and mindful of mounting misinformation lawsuits, reluctantly shelved the viral-marketing strategy, opting instead for a deliberately subdued town-hall tour across economically depressed counties.",
                difficulty: 5,
                category: "complex"
            },
            {
                id: 7,
                text: "Despite the aeronautics consortium's triumphant unveiling of next-generation hypersonic transport prototypesâ€”featuring ceramic-matrix skins and AI-adaptive flight surfacesâ€”independent safety auditors, citing unreconciled thermal-fatigue data from cryogenic wind-tunnel simulations, refused to certify the air-worthiness dossier, forcing investors to delay their multi-billion-dollar Series-D tranche until supplementary stress-fracture analyses could be peer-reviewed.",
                difficulty: 5,
                category: "complex"
            },
            {
                id: 8,
                text: "While renowned medical ethicists, echoing decades-old principles set forth in the Helsinki Declaration, argued that placebo-controlled oncology trials were no longer morally defensible, the supervisory boardâ€”keen to safeguard statistical power and anxious about shareholder litigationâ€”insisted on maintaining the double-blind design, thereby igniting a storm of resignation threats from senior clinical investigators across three continents.",
                difficulty: 5,
                category: "complex"
            },
            {
                id: 9,
                text: "After the cryptography working group, exhausted by months of midnight videoconferences, finally ratified the quantum-resistant hash-based signature standard, several cloud-security vendorsâ€”claiming that firmware supply-chain constraints rendered immediate adoption impossibleâ€”petitioned for a two-year transition window, prompting government agencies to issue contradictory compliance deadlines that cybersecurity consultants deemed \"organizationally unachievable.\"",
                difficulty: 5,
                category: "complex"
            },
            {
                id: 10,
                text: "Although the urban-planning committee, dazzled by futuristic renderings of carbon-negative skyscrapers covered in algae faÃ§ades, unanimously endorsed the redevelopment blueprint, fiscal analysts warned that unforeseen interest-rate hikes could balloon municipal bond-servicing costs beyond statutory caps, thereby obliging the mayor's office to renegotiate green-infrastructure subsidies with a newly austerity-minded legislature.",
                difficulty: 5,
                category: "complex"
            },
            {
                id: 11,
                text: "Even as the national broadcasterâ€”under mounting pressure to combat disinformationâ€”rolled out an AI-moderated fact-checking overlay for live debates, civil-rights advocates filed an injunction alleging algorithmic bias, claiming that the language-model training corpus, skewed toward elite academic prose, disproportionately flagged dialect speech patterns common in marginalized communities as \"potentially misleading.\"",
                difficulty: 5,
                category: "complex"
            },
            {
                id: 12,
                text: "While the polar-research coalition, racing against accelerated Antarctic ice-shelf collapse, deployed autonomous bathymetric drones to chart sub-ice cavities, geopolitical strategists fretted that the resulting high-resolution seabed maps, if leaked, would inadvertently expose natural-gas hydrates coveted by rival nations, thus complicating a delicate treaty renegotiation scheduled for the upcoming climate summit.",
                difficulty: 5,
                category: "complex"
            }
        ];
        
        // æç¤ºè¯æ¨¡æ¿
        const promptTemplates = {
            imitation: {
                name: "æ¨¡ä»¿å­¦ä¹ æ³•",
                prompt: `å­¦ä¹ æ ‡è®°å¥å­æˆåˆ†ï¼š

å¥å­1ï¼šBirds fly.
æ ‡è®°ï¼š[[Birds]] {{fly}}.

å¥å­2ï¼šThe cat caught a mouse quickly.
æ ‡è®°ï¼š[[The cat]] {{caught}} ((a mouse)) **quickly**.

å¥å­3ï¼šStudents who study hard pass exams.
æ ‡è®°ï¼š[[Students <<who study hard>>]] {{pass}} ((exams)).

å¥å­4ï¼šThe book which I bought is interesting.
æ ‡è®°ï¼š[[The book <<which I bought>>]] {{is}} ((interesting)).

è§„åˆ™ï¼š
- [[ä¸»è¯­]] - åŒ…å«æ‰€æœ‰ä¿®é¥°è¯­
- {{è°“è¯­}} - åªåŒ…å«åŠ¨è¯
- ((å®¾è¯­/è¡¨è¯­))
- <<ä»å¥>> - åµŒå¥—åœ¨è¢«ä¿®é¥°è¯å†…
- **çŠ¶è¯­**

ç°åœ¨æ ‡è®°ï¼š`
            },
            structured: {
                name: "ç»“æ„åŒ–è¯´æ˜æ³•",
                prompt: `åˆ†æå¥å­ç»“æ„å¹¶ç”¨ç¬¦å·æ ‡è®°ã€‚

æ ‡è®°è§„åˆ™ï¼š
1. ä¸»è¯­ï¼š[[å†…å®¹]] - åŒ…å«å®šè¯­ä»å¥å’Œæ‰€æœ‰ä¿®é¥°è¯­
2. è°“è¯­ï¼š{{åŠ¨è¯}} - åªæ ‡è®°åŠ¨è¯æœ¬èº«
3. å®¾è¯­/è¡¨è¯­ï¼š((å†…å®¹))
4. å®šè¯­ä»å¥ï¼š<<å†…å®¹>> - å¿…é¡»åµŒå¥—åœ¨è¢«ä¿®é¥°è¯çš„æ‹¬å·å†…
5. çŠ¶è¯­ï¼š**å†…å®¹** - æ—¶é—´ã€åœ°ç‚¹ã€æ–¹å¼ç­‰

ç¤ºä¾‹ï¼š[[The man <<who helped me>>]] {{is}} ((my teacher)).

å¥å­ï¼š`
            },
            minimal: {
                name: "æç®€æŒ‡ä»¤æ³•",
                prompt: `ç”¨[[ä¸»è¯­]]ã€{{è°“è¯­}}ã€((å®¾è¯­))ã€<<å®šè¯­ä»å¥>>ã€**çŠ¶è¯­**æ ‡è®°å¥å­ã€‚å®šè¯­ä»å¥åµŒå¥—åœ¨è¢«ä¿®é¥°è¯å†…ã€‚

å¥å­ï¼š`
            },
            custom: {
                name: "è‡ªå®šä¹‰",
                prompt: ""
            }
        };
        
        // åˆå§‹åŒ–é¡µé¢
        function init() {
            // æ¸²æŸ“é¢„è®¾å¥å­
            const presetList = document.getElementById('presetList');
            presetSentences.forEach(s => {
                const div = document.createElement('div');
                div.className = 'sentence-option';
                div.textContent = `${s.id}. (éš¾åº¦${s.difficulty}) ${s.text}`;
                div.onclick = () => {
                    document.getElementById('sentenceInput').value = s.text;
                };
                presetList.appendChild(div);
            });
            
            // æ¸²æŸ“æç¤ºè¯æ¨¡æ¿
            const templateDiv = document.getElementById('promptTemplates');
            Object.entries(promptTemplates).forEach(([key, template]) => {
                const div = document.createElement('div');
                div.className = 'prompt-card';
                div.innerHTML = `<h3>${template.name}</h3><pre style="font-size: 12px; overflow: hidden; text-overflow: ellipsis;">${template.prompt.substring(0, 100)}...</pre>`;
                div.onclick = () => {
                    document.querySelectorAll('.prompt-card').forEach(c => c.classList.remove('active'));
                    div.classList.add('active');
                    document.getElementById('promptInput').value = template.prompt;
                };
                templateDiv.appendChild(div);
            });
            
            // é»˜è®¤é€‰æ‹©ç¬¬ä¸€ä¸ªæ¨¡æ¿
            templateDiv.firstChild.click();
        }
        
        async function callAPI(prompt, sentence) {
            const fullPrompt = prompt + (prompt.endsWith('\n') || prompt.endsWith(' ') || prompt.endsWith('ï¼š') ? '' : '\n') + sentence;
            
            const response = await fetch(API_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${API_KEY}`
                },
                body: JSON.stringify({
                    model: 'qwen-turbo-latest',
                    messages: [
                        { role: "user", content: fullPrompt }
                    ],
                    temperature: 0.3,
                    max_tokens: 1000
                })
            });
            
            const data = await response.json();
            if (data.choices?.[0]?.message?.content) {
                return data.choices[0].message.content;
            }
            throw new Error('APIè°ƒç”¨å¤±è´¥');
        }
        
        function visualizeResult(marked) {
            return marked
                .replace(/\[\[(.+?)\]\]/g, '<span class="subject">$1</span>')
                .replace(/\{\{(.+?)\}\}/g, '<span class="verb">$1</span>')
                .replace(/\(\((.+?)\)\)/g, '<span class="object">$1</span>')
                .replace(/<<(.+?)>>/g, '<span class="clause">$1</span>')
                .replace(/\*\*(.+?)\*\*/g, '<span class="modifier">$1</span>');
        }
        
        async function testSingle() {
            const sentence = document.getElementById('sentenceInput').value.trim();
            const prompt = document.getElementById('promptInput').value.trim();
            
            if (!sentence || !prompt) {
                alert('è¯·è¾“å…¥å¥å­å’Œæç¤ºè¯');
                return;
            }
            
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="loading">æµ‹è¯•ä¸­...</div>';
            
            try {
                const result = await callAPI(prompt, sentence);
                
                resultsDiv.innerHTML = `
                    <div class="result-section">
                        <h3>æµ‹è¯•ç»“æœ</h3>
                        <div class="marked-result">
                            <strong>åŸå§‹è¾“å‡ºï¼š</strong><br>
                            <div class="raw-result">${result}</div>
                        </div>
                        <div class="marked-result">
                            <strong>å¯è§†åŒ–ï¼š</strong><br>
                            ${visualizeResult(result)}
                        </div>
                    </div>
                `;
            } catch (error) {
                resultsDiv.innerHTML = `<div class="error">é”™è¯¯ï¼š${error.message}</div>`;
            }
        }
        
        async function testAll() {
            const prompt = document.getElementById('promptInput').value.trim();
            if (!prompt) {
                alert('è¯·é€‰æ‹©æˆ–è¾“å…¥æç¤ºè¯');
                return;
            }
            
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="loading">æ‰¹é‡æµ‹è¯•ä¸­...</div>';
            
            let html = '<div class="result-section"><h3>æ‰¹é‡æµ‹è¯•ç»“æœ</h3>';
            let successCount = 0;
            
            for (const sentence of presetSentences) {
                try {
                    const result = await callAPI(prompt, sentence.text);
                    const hasMarking = result.includes('[[') || result.includes('{{');
                    
                    if (hasMarking) successCount++;
                    
                    html += `
                        <div style="margin: 20px 0; padding: 20px; background: #f9fafb; border-radius: 8px;">
                            <h4>å¥å­ ${sentence.id} (éš¾åº¦ ${sentence.difficulty})</h4>
                            <div style="margin: 10px 0; padding: 10px; background: white; border-radius: 4px;">
                                ${sentence.text}
                            </div>
                            <div class="marked-result">
                                ${visualizeResult(result)}
                            </div>
                        </div>
                    `;
                    
                    await new Promise(resolve => setTimeout(resolve, 500));
                } catch (error) {
                    html += `<div class="error">å¥å­ ${sentence.id} æµ‹è¯•å¤±è´¥ï¼š${error.message}</div>`;
                }
            }
            
            html += `
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-value">${successCount}/${presetSentences.length}</div>
                        <div class="stat-label">æˆåŠŸæ ‡è®°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${((successCount/presetSentences.length)*100).toFixed(1)}%</div>
                        <div class="stat-label">æˆåŠŸç‡</div>
                    </div>
                </div>
            </div>`;
            
            resultsDiv.innerHTML = html;
        }
        
        async function batchTest() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="loading">æ‰¹é‡æµ‹è¯•å¤šä¸ªæç¤ºè¯...</div>';
            
            let html = '<div class="result-section"><h3>æ‰¹é‡æµ‹è¯•ç»“æœå¯¹æ¯”</h3>';
            const testResults = {};
            
            // æµ‹è¯•æ¯ä¸ªæç¤ºè¯æ¨¡æ¿
            for (const [key, template] of Object.entries(promptTemplates)) {
                if (key === 'custom') continue;
                
                testResults[key] = {
                    name: template.name,
                    results: [],
                    successCount: 0
                };
                
                // æµ‹è¯•å‰3ä¸ªå¥å­
                for (let i = 0; i < Math.min(3, presetSentences.length); i++) {
                    const sentence = presetSentences[i];
                    try {
                        const result = await callAPI(template.prompt, sentence.text);
                        const hasMarking = result.includes('[[') && result.includes('{{');
                        
                        if (hasMarking) testResults[key].successCount++;
                        
                        testResults[key].results.push({
                            sentence: sentence.text,
                            result: result,
                            success: hasMarking
                        });
                        
                        await new Promise(resolve => setTimeout(resolve, 500));
                    } catch (error) {
                        testResults[key].results.push({
                            sentence: sentence.text,
                            error: error.message
                        });
                    }
                }
            }
            
            // æ˜¾ç¤ºå¯¹æ¯”ç»“æœ
            html += '<div class="stats">';
            Object.entries(testResults).forEach(([key, data]) => {
                const rate = ((data.successCount / data.results.length) * 100).toFixed(1);
                html += `
                    <div class="stat-card">
                        <div class="stat-value">${rate}%</div>
                        <div class="stat-label">${data.name}</div>
                    </div>
                `;
            });
            html += '</div>';
            
            // è¯¦ç»†ç»“æœ
            Object.entries(testResults).forEach(([key, data]) => {
                html += `<h4>${data.name}</h4>`;
                data.results.forEach((r, i) => {
                    if (r.error) {
                        html += `<div class="error">é”™è¯¯ï¼š${r.error}</div>`;
                    } else {
                        html += `
                            <div style="margin: 10px 0;">
                                <div style="font-size: 14px; color: #666;">å¥å­ ${i+1}ï¼š</div>
                                <div class="marked-result" style="font-size: 16px;">
                                    ${visualizeResult(r.result)}
                                </div>
                            </div>
                        `;
                    }
                });
            });
            
            html += '</div>';
            resultsDiv.innerHTML = html;
        }
        
        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }
        
        // åˆå§‹åŒ–
        init();
    </script>
</body>
</html>