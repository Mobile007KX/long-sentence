<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>AIæ ‡è®°æ–¹æ³•æµ‹è¯•å™¨</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            background: #252526;
            border-radius: 8px;
        }
        h2 { color: #4ec9b0; }
        .success { color: #6a9955; }
        .error { color: #f48771; }
        .result {
            margin: 10px 0;
            padding: 10px;
            background: #1e1e1e;
            border-radius: 4px;
            white-space: pre-wrap;
        }
        button {
            background: #007acc;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .sentence-preview {
            font-size: 20px;
            line-height: 1.8;
            padding: 20px;
            background: white;
            color: black;
            border-radius: 8px;
            margin: 10px 0;
        }
        .subject { background: #ffebee; color: #c62828; padding: 2px 6px; border-radius: 3px; }
        .verb { background: #e3f2fd; color: #1565c0; padding: 2px 6px; border-radius: 3px; }
        .object { background: #e8f5e9; color: #2e7d32; padding: 2px 6px; border-radius: 3px; }
        .modifier { background: #f3e5f5; color: #6a1b9a; padding: 2px 6px; border-radius: 3px; }
        .clause { border-bottom: 2px dashed #ff9800; }
    </style>
</head>
<body>
    <h1>ğŸ§ª AIæ ‡è®°æ–¹æ³•è‡ªåŠ¨æµ‹è¯•å™¨</h1>
    
    <div class="test-section">
        <h2>æµ‹è¯•ä¸åŒçš„æç¤ºè¯æ–¹æ³•</h2>
        <button onclick="testAllMethods()">å¼€å§‹è‡ªåŠ¨æµ‹è¯•</button>
        <button onclick="clearResults()">æ¸…é™¤ç»“æœ</button>
        <div id="results"></div>
    </div>

    <script>
        const API_KEY = 'sk-8a9d17f2199449ca87988c5d82ae30be';
        const API_URL = 'https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions';
        
        // ä¸åŒçš„æç¤ºè¯æ–¹æ³•
        const methods = {
            // æ–¹æ³•1: ç›´æ¥ç¤ºä¾‹
            directExample: {
                name: "ç›´æ¥ç¤ºä¾‹æ³•",
                systemPrompt: `ç”Ÿæˆå¸¦HTMLæ ‡è®°çš„è‹±è¯­å¥å­ã€‚ç›´æ¥çœ‹ä¾‹å­ï¼š

è¾“å…¥ï¼šç”ŸæˆSVOå¥å­
è¾“å‡ºï¼š<span class="subject">The boy</span> <span class="verb">ate</span> <span class="object">an apple</span>.

è¾“å…¥ï¼šç”ŸæˆåŒ…å«å®šè¯­ä»å¥çš„SVOå¥å­  
è¾“å‡ºï¼š<span class="subject">The students <span class="clause">who work hard</span></span> <span class="verb">achieve</span> <span class="object">success</span>.

æ ‡è®°è§„åˆ™ï¼š
- ä¸»è¯­ç”¨ <span class="subject">
- è°“è¯­ç”¨ <span class="verb">
- å®¾è¯­ç”¨ <span class="object">
- å®šè¯­ä»å¥ç”¨ <span class="clause"> ä¸”è¦åµŒå¥—åœ¨è¢«ä¿®é¥°è¯å†…
- çŠ¶è¯­ç”¨ <span class="modifier">`
            },
            
            // æ–¹æ³•2: è§„åˆ™è¯´æ˜
            rulesBased: {
                name: "è§„åˆ™è¯´æ˜æ³•",
                systemPrompt: `ä½ æ˜¯è‹±è¯­å¥å­ç”Ÿæˆå™¨ã€‚ç”Ÿæˆå¥å­æ—¶ä½¿ç”¨HTMLæ ‡è®°ã€‚

è§„åˆ™ï¼š
1. è¯†åˆ«å¥å­æˆåˆ†
2. ç”¨å¯¹åº”çš„spanæ ‡ç­¾åŒ…è£¹
3. classå±æ€§ï¼šsubject/verb/object/modifier/clause
4. å®šè¯­ä»å¥å¿…é¡»åµŒå¥—åœ¨å®ƒä¿®é¥°çš„åè¯æ‰€åœ¨çš„spanå†…

è¾“å‡ºJSONæ ¼å¼ï¼š
{
  "marked": "å¸¦æ ‡è®°çš„å¥å­",
  "plain": "çº¯æ–‡æœ¬å¥å­"
}`
            },
            
            // æ–¹æ³•3: åˆ†æ­¥æŒ‡å¯¼
            stepByStep: {
                name: "åˆ†æ­¥æŒ‡å¯¼æ³•", 
                systemPrompt: `ç”Ÿæˆå¸¦æ ‡è®°çš„è‹±è¯­å¥å­ã€‚

æ­¥éª¤ï¼š
1. å…ˆå†™å‡ºå®Œæ•´å¥å­
2. è¯†åˆ«ä¸»è°“å®¾ç­‰æˆåˆ†
3. æ·»åŠ HTMLæ ‡è®°ï¼š
   - <span class="subject">ä¸»è¯­</span>
   - <span class="verb">è°“è¯­</span>
   - <span class="object">å®¾è¯­</span>
4. ç‰¹æ®Šå¤„ç†ï¼šå®šè¯­ä»å¥è¦åµŒå¥—åœ¨è¢«ä¿®é¥°è¯çš„spanå†…

ç¤ºä¾‹ï¼šThe man who helped me is kind.
æ ‡è®°ï¼š<span class="subject">The man <span class="clause">who helped me</span></span> <span class="verb">is</span> <span class="object">kind</span>.`
            },
            
            // æ–¹æ³•4: æ¨¡æ¿æ›¿æ¢
            template: {
                name: "æ¨¡æ¿æ›¿æ¢æ³•",
                systemPrompt: `ç”Ÿæˆå¥å­å¹¶æ ‡è®°æˆåˆ†ã€‚ä½¿ç”¨ä»¥ä¸‹æ¨¡æ¿ï¼š

[ä¸»è¯­] [è°“è¯­] [å®¾è¯­]

ç„¶åæ›¿æ¢ä¸ºï¼š
<span class="subject">[ä¸»è¯­]</span> <span class="verb">[è°“è¯­]</span> <span class="object">[å®¾è¯­]</span>

å¦‚æœæœ‰å®šè¯­ä»å¥ï¼ŒåµŒå¥—å¤„ç†ï¼š
<span class="subject">[åè¯] <span class="clause">[å®šè¯­ä»å¥]</span></span>`
            },
            
            // æ–¹æ³•5: æ··åˆæ–¹æ³•
            hybrid: {
                name: "æ··åˆæ–¹æ³•",
                systemPrompt: `ç”Ÿæˆå¸¦HTMLæ ‡è®°çš„è‹±è¯­å¥å­ã€‚

æ ¸å¿ƒæ¦‚å¿µï¼šæŠŠå¥å­æˆåˆ†ç”¨HTML spanæ ‡ç­¾åŒ…è£¹ï¼Œclassè¡¨ç¤ºæˆåˆ†ç±»å‹ã€‚

ç¤ºä¾‹1: The cat sleeps.
â†’ <span class="subject">The cat</span> <span class="verb">sleeps</span>.

ç¤ºä¾‹2: Students who study hard succeed.  
â†’ <span class="subject">Students <span class="clause">who study hard</span></span> <span class="verb">succeed</span>.

è¦æ±‚ï¼š
1. æ‰€æœ‰æˆåˆ†éƒ½è¦æ ‡è®°
2. å®šè¯­ä»å¥åµŒå¥—åœ¨è¢«ä¿®é¥°è¯å†…
3. è¿”å›JSON: {"marked": "...", "plain": "..."}`
            }
        };
        
        // æµ‹è¯•å¥å­è¦æ±‚
        const testRequests = [
            { pattern: "SVO", desc: "ç®€å•SVOå¥å­" },
            { pattern: "SVO", desc: "åŒ…å«å®šè¯­ä»å¥çš„SVOå¥å­" },
            { pattern: "SVOO", desc: "åŒå®¾è¯­å¥å­" },
            { pattern: "SVO", desc: "åŒ…å«çŠ¶è¯­çš„å¤æ‚å¥å­" }
        ];
        
        async function testMethod(methodKey, method) {
            log(`\nğŸ“ æµ‹è¯•æ–¹æ³•: ${method.name}`);
            let successCount = 0;
            
            for (const req of testRequests) {
                try {
                    const prompt = `ç”Ÿæˆä¸€ä¸ª${req.desc}ï¼Œå¥å‹æ˜¯${req.pattern}ã€‚`;
                    const result = await callAPI(method.systemPrompt, prompt);
                    
                    // æ£€æŸ¥ç»“æœ
                    const validation = validateResult(result, req);
                    if (validation.valid) {
                        successCount++;
                        log(`âœ… ${req.desc}: æˆåŠŸ`, 'success');
                        showPreview(validation.marked);
                    } else {
                        log(`âŒ ${req.desc}: ${validation.error}`, 'error');
                        log(`   å“åº”: ${JSON.stringify(result).substring(0, 100)}...`, 'error');
                    }
                    
                } catch (error) {
                    log(`âŒ ${req.desc}: ${error.message}`, 'error');
                }
                
                await sleep(500); // é¿å…é¢‘ç‡é™åˆ¶
            }
            
            const score = (successCount / testRequests.length * 100).toFixed(0);
            log(`ğŸ“Š ${method.name} æˆåŠŸç‡: ${score}%`);
            return { method: methodKey, score: parseInt(score) };
        }
        
        async function callAPI(systemPrompt, userPrompt) {
            const response = await fetch(API_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${API_KEY}`
                },
                body: JSON.stringify({
                    model: 'qwen-turbo-latest',
                    messages: [
                        { role: "system", content: systemPrompt },
                        { role: "user", content: userPrompt }
                    ],
                    temperature: 0.3,
                    max_tokens: 500
                })
            });
            
            const data = await response.json();
            if (data.choices?.[0]?.message?.content) {
                const content = data.choices[0].message.content;
                
                // å°è¯•è§£æJSON
                try {
                    return JSON.parse(content);
                } catch {
                    // å¦‚æœä¸æ˜¯JSONï¼Œå°è¯•æå–æ ‡è®°çš„å¥å­
                    if (content.includes('<span')) {
                        return { marked: content, plain: content.replace(/<[^>]+>/g, '') };
                    }
                    return { marked: content };
                }
            }
            throw new Error('APIè°ƒç”¨å¤±è´¥');
        }
        
        function validateResult(result, requirement) {
            // æ£€æŸ¥æ˜¯å¦æœ‰æ ‡è®°çš„å¥å­
            const marked = result.marked || result.sentence || result.output || '';
            
            if (!marked) {
                return { valid: false, error: 'æ— è¾“å‡º' };
            }
            
            // æ£€æŸ¥æ˜¯å¦åŒ…å«HTMLæ ‡è®°
            if (!marked.includes('<span')) {
                return { valid: false, error: 'ç¼ºå°‘HTMLæ ‡è®°' };
            }
            
            // æ£€æŸ¥å¿…è¦çš„æ ‡è®°
            const hasSubject = marked.includes('class="subject"') || marked.includes("class='subject'");
            const hasVerb = marked.includes('class="verb"') || marked.includes("class='verb'");
            
            if (!hasSubject || !hasVerb) {
                return { valid: false, error: 'ç¼ºå°‘å¿…è¦çš„æˆåˆ†æ ‡è®°' };
            }
            
            // æ£€æŸ¥å®šè¯­ä»å¥åµŒå¥—ï¼ˆå¦‚æœè¦æ±‚åŒ…å«å®šè¯­ä»å¥ï¼‰
            if (requirement.desc.includes('å®šè¯­ä»å¥')) {
                const hasClause = marked.includes('class="clause"') || marked.includes("class='clause'");
                if (!hasClause) {
                    return { valid: false, error: 'ç¼ºå°‘å®šè¯­ä»å¥æ ‡è®°' };
                }
                
                // ç®€å•æ£€æŸ¥åµŒå¥—ç»“æ„
                if (!marked.includes('</span></span>')) {
                    return { valid: false, error: 'å®šè¯­ä»å¥æœªæ­£ç¡®åµŒå¥—' };
                }
            }
            
            return { valid: true, marked: marked };
        }
        
        function showPreview(markedSentence) {
            const preview = document.createElement('div');
            preview.className = 'sentence-preview';
            preview.innerHTML = markedSentence;
            document.getElementById('results').appendChild(preview);
        }
        
        async function testAllMethods() {
            log('ğŸš€ å¼€å§‹æµ‹è¯•æ‰€æœ‰æ–¹æ³•...\n');
            const scores = [];
            
            for (const [key, method] of Object.entries(methods)) {
                const result = await testMethod(key, method);
                scores.push(result);
                log('\n' + '='.repeat(50) + '\n');
            }
            
            // æ‰¾å‡ºæœ€ä½³æ–¹æ³•
            const best = scores.reduce((a, b) => a.score > b.score ? a : b);
            log(`\nğŸ† æœ€ä½³æ–¹æ³•: ${methods[best.method].name} (${best.score}%)`);
            
            // æ˜¾ç¤ºæœ€ä½³æç¤ºè¯
            log('\nğŸ“‹ æœ€ä½³æç¤ºè¯å†…å®¹:');
            log(methods[best.method].systemPrompt);
        }
        
        function log(message, type = '') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.textContent = message;
            results.appendChild(div);
        }
        
        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }
        
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
    </script>
</body>
</html>